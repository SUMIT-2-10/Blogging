<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= blog.title %> - Blog</title>
    <%- include('partials/head') %>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #171123;
            min-height: 100vh;
            color: white !important;
        }

        .blog-container {
            max-width: 800px;
            margin: 30px auto;
            background: #2a1f3d;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(111, 45, 189, 0.3);
            border-top: 4px solid #6f2dbd;
            color: white !important;
        }

        .blog-container * {
            color: white !important;
        }

        .blog-cover {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .blog-title {
            color: white !important;
            margin-bottom: 15px;
            font-size: 2.5em;
        }

        .blog-meta {
            color: white !important;
            font-size: 0.9em;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #6f2dbd;
        }

        .blog-content {
            line-height: 1.8;
            color: white !important;
            font-size: 1.1em;
            white-space: pre-wrap;
        }

        .blog-meta {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .blog-content {
            line-height: 1.8;
            color: #444;
            font-size: 1.1em;
            white-space: pre-wrap;
        }

        .comments-section {
            margin-top: 30px;
        }

        .comment {
            background: #1f1732;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid #6f2dbd;
            box-shadow: 0 2px 8px rgba(111, 45, 189, 0.2);
            transition: all 0.3s ease;
        }

        .comment:hover {
            box-shadow: 0 4px 12px rgba(111, 45, 189, 0.4);
            transform: translateX(5px);
        }

        .comment-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .comment-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .comment-author {
            font-weight: bold;
            color: white !important;
        }

        .comment-date {
            color: white !important;
            font-size: 0.85em;
            margin-left: auto;
        }

        .comment-content {
            color: white !important;
            line-height: 1.6;
        }

        .comment-date {
            color: #888;
            font-size: 0.85em;
            margin-left: auto;
        }

        .comment-content {
            color: #555;
            line-height: 1.6;
        }

        .profileimag {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .profileimag img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .username {
            font-weight: bold;
            color: #333;
        }
    </style>
</head>

<body>
    <%- include('partials/nav') %>
    
    <div class="blog-container">
        <% if (blog.coverImageURL) { %>
            <img src="<%= blog.coverImageURL %>" alt="<%= blog.title %>" class="blog-cover">
        <% } %>
        
        <h1 class="blog-title"><%= blog.title %></h1>
        
        <div class="blog-meta">
            <span>Published on <%= new Date(blog.createdAt).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %></span>
        </div>
        
        <div class="blog-content">
            <%= blog.content %>
        </div>
    </div>

    <!-- Comments Section -->
    <div class="blog-container comments-section">
        <h2 style="color: white; border-bottom: 3px solid #6f2dbd; padding-bottom: 15px; margin-bottom: 25px;">Comments (<%= comments.length %>)</h2>
        
        <% if (comments.length > 0) { %>
            <% comments.forEach(comment => { %>
                <div class="comment">
                    <div class="comment-header">
                        <!-- Debug: <%= comment.createdBy.profileImageURL %> -->
                        <img src="<%= comment.createdBy.profileImageURL || '/image/profile-icon-png-910.png' %>" alt="<%= comment.createdBy.fullname %>" class="comment-avatar" onerror="this.src='/image/profile-icon-png-910.png'">
                        <span class="comment-author"><%= comment.createdBy.fullname %></span>
                        <span class="comment-date"><%= new Date(comment.createdAt).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }) %></span>
                    </div>
                    <div class="comment-content">
                        <%= comment.content %>
                    </div>
                </div>
            <% }) %>
        <% } else { %>
            <p style="color: white; text-align: center; padding: 20px;">No comments yet. Be the first to comment!</p>
        <% } %>
    </div>

    <% if (user) { %>
    <div class="blog-container" style="margin-top: 20px;">
        <h2 style="color: white; border-bottom: 3px solid #6f2dbd; padding-bottom: 15px; margin-bottom: 25px;">Add a Comment</h2>
        <form action="/blog/<%= blog._id %>/comment" method="POST">
            <div class="mb-3">
                <div class="profileimag">
                    <img src="<%= user.profileImageURL || '/image/profile-icon-png-910.png' %>" alt="Profile Image">
                    <div class="username" style="color: white;"><%= user.fullname %></div>
                </div>
                <textarea class="form-control" name="content" rows="4" placeholder="Write your comment here..." required style="background-color: #1f1732; color: white; border-color: #6f2dbd;"></textarea>
            </div>
            <button type="submit" class="btn btn-primary" style="background-color: #6f2dbd; border-color: #6f2dbd;">Add Comment</button>
        </form>
    </div>
    <% } %>
    
    <%- include('partials/script') %>
</body>

</html>